{% extends "base.html" %}

{% block title %}Separa√ß√µes{% endblock %}

{% block content %}
<!-- Fila de Separa√ß√£o -->
<section class="form-container" id="container-fila-separadores"
    style="max-width: 1000px; padding: 1rem 1.5rem; margin: 1rem auto 0.5rem;">
    <ol id="fila-separadores-lista" class="fila-separadores" style="margin-top: 0;">
        <li>Carregando...</li>
    </ol>
</section>

<!-- Formul√°rio de Cria√ß√£o -->
<section class="form-container" id="form-container-separacao"
    style="display:none; padding: 1rem 1.5rem; margin: 0 auto 0.5rem;">
    <form id="form-separacao">
        <div style="display: flex; gap: 1rem; align-items: flex-end;">
            <div class="form-group" style="margin-bottom: 0; flex-grow: 1;">
                <label for="numero-movimentacao">N¬∫ Movimenta√ß√£o</label>
                <input type="number" id="numero-movimentacao" required>
            </div>
            <div class="form-group" style="margin-bottom: 0; width: 120px;">
                <label for="qtd-pecas">Qtd. Pe√ßas</label>
                <input type="number" id="qtd-pecas" required>
            </div>
            <div class="form-group" style="margin-bottom: 0; flex-grow: 2;">
                <label for="nome-cliente">Nome do Cliente</label>
                <input type="text" id="nome-cliente" required>
            </div>
            <div class="form-group" style="margin-bottom: 0; flex-grow: 1;">
                <label for="vendedor-nome">Vendedor</label>
                <select id="vendedor-nome" required data-placeholder="Vendedor">
                    <option value="" disabled selected>Carregando...</option>
                </select>
            </div>

            <div class="form-group" style="margin-bottom: 0; flex-grow: 1.5;">
                <label>Separador(es)</label>
                <div id="separadores-selecionados-display" class="selected-items-display"
                    style="padding: 0.5rem; border: 1px solid var(--border-strong); border-radius: var(--border-radius); min-height: 38px; background: var(--bg-muted); font-size: 0.9rem; color: var(--text-secondary); cursor: pointer; line-height: 1.4; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;"
                    title="Clique para selecionar">
                    Nenhum selecionado
                </div>
            </div>

            <div class="form-group" style="margin-bottom: 0;">
                <button type="submit" class="btn btn--primary">Criar</button>
            </div>
        </div>
    </form>
</section>

<!-- Barra de Busca -->
<section class="filtro-container-actions" style="margin: 0 auto 1.5rem;">
    <input type="text" id="filtro-separacoes" placeholder="üîé Buscar por N¬∫ Mov, Cliente, Vendedor...">
    <button id="btn-reload-separacoes" class="btn btn--secondary">Atualizar</button>
    <button id="btn-gerenciar-fila" class="btn btn--primary" style="display: none;">Gerenciar Fila</button>
</section>

<section class="layout-grid-3-cols">
    <div class="quadro-coluna">
        <h2>Separa√ß√µes em Andamento</h2>
        <div id="quadro-separacoes-andamento" class="quadro-container"></div>
    </div>
    <div class="quadro-coluna">
        <h2>Separa√ß√µes em Confer√™ncia</h2>
        <div id="quadro-separacoes-conferencia" class="quadro-container"></div>
    </div>
    <div class="quadro-coluna">
        <h2>Separa√ß√µes Finalizadas</h2>
        <div id="quadro-separacoes-finalizadas" class="quadro-container"></div>
    </div>
</section>

<div id="pagination-container" class="pagination-container">
    <div id="loading-spinner" class="spinner" style="display: none;"></div>
    <button id="btn-carregar-mais" class="btn btn--secondary">Carregar mais antigas</button>
</div>

<!-- Modal de Observa√ß√£o (ATUALIZADO COM HIST√ìRICO) -->
<div id="obs-separacao-modal-overlay" class="modal-overlay" style="display:none;">
    <div class="modal-content" style="max-width: 600px;">
        <div class="modal-header">
            <h2 id="obs-separacao-modal-title">Observa√ß√µes da Separa√ß√£o</h2>
            <button class="close-modal close-modal-icon">√ó</button>
        </div>
        <form id="form-obs-separacao" novalidate>
            <div class="modal-body">
                <!-- Container para o Hist√≥rico -->
                <div id="separacao-historico-observacoes" class="obs-log-container"
                    style="max-height: 250px; margin-bottom: 1.5rem;">
                    <!-- Preenchido via JS -->
                </div>
                <div class="form-group">
                    <label for="obs-texto">Escrever Nova Observa√ß√£o:</label>
                    <textarea id="obs-texto" rows="4" required placeholder="Digite aqui..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn--secondary close-modal">Cancelar</button>
                <button type="submit" id="btn-save-obs-separacao" class="btn btn--primary">Salvar Observa√ß√£o</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal para Gerenciar Fila -->
<div id="gerenciar-fila-modal-overlay" class="modal-overlay" style="display:none;">
    <div class="modal-content" style="max-width: 500px;">
        <div class="modal-header">
            <h2>Gerenciar Fila de Separa√ß√£o</h2>
            <button class="close-modal close-modal-icon">√ó</button>
        </div>
        <form id="form-gerenciar-fila">
            <div class="modal-body">
                <p>Marque os separadores ativos na fila:</p>
                <div id="fila-checkbox-container" class="permissions-grid"
                    style="grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));">
                    <div class="spinner" style="margin: 1rem auto;"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn--secondary close-modal">Cancelar</button>
                <button type="submit" id="btn-save-fila" class="btn btn--primary">Salvar Altera√ß√µes</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal de Sele√ß√£o de Separadores (Cria√ß√£o) -->
<div id="selecionar-separador-modal-overlay" class="modal-overlay" style="display:none;">
    <div class="modal-content" style="max-width: 500px;">
        <div class="modal-header">
            <h2 id="selecionar-separador-modal-title">Selecionar Separadores</h2>
            <button class="close-modal close-modal-icon">√ó</button>
        </div>
        <div class="modal-body">
            <div id="separadores-checkbox-container" class="permissions-grid"
                style="grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));"></div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn--secondary close-modal">Cancelar</button>
            <button type="button" id="btn-confirmar-selecao-separadores" class="btn btn--primary">Confirmar
                Sele√ß√£o</button>
        </div>
    </div>
</div>

<!-- Modal de Edi√ß√£o (Geral) -->
<div id="edit-separacao-modal-overlay" class="modal-overlay" style="display:none;">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="edit-separacao-modal-title">Editar Separa√ß√£o</h2>
            <button class="close-modal close-modal-icon">√ó</button>
        </div>
        <form id="form-edit-separacao" novalidate>
            <div class="modal-body">
                <div class="layout-grid-2-cols" style="gap: 1rem;">
                    <div class="form-group"><label>N¬∫ Movimenta√ß√£o</label><input type="number"
                            id="edit-numero-movimentacao" required></div>
                    <div class="form-group"><label>Qtd. Pe√ßas</label><input type="number" id="edit-qtd-pecas" required>
                    </div>
                </div>
                <div class="form-group"><label>Nome do Cliente</label><input type="text" id="edit-nome-cliente"
                        required></div>
                <div class="form-group"><label>Vendedor</label><select id="edit-vendedor-nome" required></select></div>
                <div class="form-group">
                    <label>Separador(es)</label>
                    <div id="edit-separador-container" class="permissions-grid"
                        style="grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); border: 1px solid var(--border-strong); padding: 0.75rem; border-radius: var(--border-radius);">
                    </div>
                </div>
                <div class="form-group"><label>Conferente</label><select id="edit-conferente-nome"></select></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn--secondary close-modal">Cancelar</button>
                <button type="submit" id="btn-save-edit-separacao" class="btn btn--primary">Salvar Altera√ß√µes</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}