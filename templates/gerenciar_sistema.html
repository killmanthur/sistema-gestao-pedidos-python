{% extends "base.html" %}

{% block title %}Gerenciar Sistema{% endblock %}

{% block content %}
<section class="form-container" style="max-width: 1300px; margin-bottom: 2rem; border-left: 5px solid var(--clr-info);">
    <h3>Gerenciador de Listas Din√¢micas</h3>
    <p>Use esta ferramenta para adicionar ou remover nomes rapidamente dos menus do sistema (ex: Vendedores, Marcas) sem
        precisar criar contas de usu√°rio.</p>

    <div class="layout-grid-2-cols" style="align-items: start; gap: 2rem; margin-top: 1.5rem;">
        <div>
            <div class="form-group">
                <label for="lista-selecionada">Selecione a Lista para Editar</label>
                <select id="lista-selecionada">
                    <option value="" disabled selected>Carregando listas...</option>
                </select>
            </div>
            <div class="form-group">
                <p style="font-size: 0.9rem; color: var(--text-secondary);">
                    <strong>Instru√ß√µes:</strong><br>
                    1. Selecione uma lista acima.<br>
                    2. Edite os nomes na caixa ao lado (um por linha).<br>
                    3. Clique em "Salvar Lista".
                </p>
            </div>
        </div>
        <div>
            <div class="form-group">
                <label for="editor-lista-itens">Itens da Lista (Um nome por linha)</label>
                <textarea id="editor-lista-itens" rows="10"
                    style="font-family: monospace; white-space: pre;"></textarea>
            </div>
            <div style="text-align: right;">
                <button id="btn-salvar-lista" class="btn btn--primary" disabled>Salvar Lista</button>
            </div>
        </div>
    </div>
</section>
<hr>
<section class="form-container" style="max-width: 1300px;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
        <h2>Gerenciar Usu√°rios e Permiss√µes</h2>
        <button id="btn-create-user" class="btn btn--primary">Criar Novo Usu√°rio</button>
    </div>
    <p>Adicione, edite, remova e gerencie as permiss√µes de acesso de cada usu√°rio no sistema.</p>

    <!-- NOVO CAMPO DE BUSCA -->
    <div style="margin: 2rem 0;">
        <input type="search" id="filtro-tabela-usuarios" placeholder="üîé Buscar por nome, email ou role...">
    </div>

    <div id="loading-spinner-users" class="spinner" style="display: block; margin: 2rem auto;"></div>
    <table id="users-table" class="admin-table" style="display: none; width: 100%; margin-top: 2rem;">
        <thead>
            <tr>
                <th class="sortable" data-sort="nome">Nome</th>
                <th class="sortable" data-sort="email">Email</th>
                <th class="sortable" data-sort="role">Role (Grupo)</th>
                <th style="width: 280px;">A√ß√µes</th>
            </tr>
        </thead>
        <tbody id="users-table-body"></tbody>
    </table>
</section>

<!-- MODAL PARA DEFINIR NOVA SENHA (RESET DE SENHA) -->
<div id="set-password-modal-overlay" class="modal-overlay" style="display: none;">
    <div class="modal-content" style="max-width: 400px;">
        <div class="modal-header">
            <h2>Definir Nova Senha</h2>
            <button class="close-modal close-modal-icon">√ó</button>
        </div>
        <form id="form-set-password" novalidate>
            <div class="modal-body">
                <p>Alterando senha para: <strong id="set-password-user-name"></strong></p>
                <div class="form-group">
                    <label for="new-password">Nova Senha (m√≠n. 6 caracteres)</label>
                    <input type="password" id="new-password" required minlength="6">
                </div>
                <div class="form-group">
                    <label for="confirm-password">Confirmar Nova Senha</label>
                    <input type="password" id="confirm-password" required minlength="6">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn--secondary close-modal">Cancelar</button>
                <button type="submit" id="btn-save-set-password" class="btn btn--primary">Salvar Nova Senha</button>
            </div>
        </form>
    </div>
</div>

<div id="user-modal-overlay" class="modal-overlay" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="user-modal-title">Novo Usu√°rio</h2>
            <!-- CORRE√á√ÉO AQUI -->
            <button class="close-modal close-modal-icon">√ó</button>
        </div>
        <form id="form-user" novalidate>
            <div class="modal-body">
                <input type="hidden" id="user-uid">
                <div class="layout-grid-2-cols" style="gap: 1rem;">
                    <div class="form-group">
                        <label for="user-nome">Nome Completo</label>
                        <input type="text" id="user-nome" required>
                    </div>
                    <div class="form-group">
                        <label for="user-email">Email</label>
                        <input type="email" id="user-email" required>
                    </div>
                </div>
                <div id="password-group" class="form-group">
                    <label for="user-password">Senha (m√≠nimo 6 caracteres)</label>
                    <input type="password" id="user-password" minlength="6">
                </div>
                <div class="form-group">
                    <label for="user-role">Role (Grupo de Permiss√£o)</label>
                    <select id="user-role" required>
                        <option value="Vendedor">Vendedor</option>
                        <option value="Comprador">Comprador</option>
                        <option value="Estoque">Estoque</option>
                        <option value="Separador">Separador</option>
                        <option value="Expedi√ß√£o">Expedi√ß√£o</option>
                        <option value="Recep√ß√£o">Recep√ß√£o</option>>
                        <option value="Contabilidade">Contabilidade</option>
                        <option value="Admin">Admin</option>
                    </select>
                </div>
                <hr>

                <h4>P√°ginas Acess√≠veis</h4>
                <div id="pages-permissions-container" class="permissions-grid">
                </div>

                <hr>

                <h4>Permiss√µes (Separa√ß√µes)</h4>
                <div id="separacoes-permissions-container" class="permissions-grid">
                </div>
                <hr>

                <h4>Permiss√µes (Sugest√µes)</h4>
                <div id="sugestoes-permissions-container" class="permissions-grid">
                </div>
                <hr>

                <h4>Permiss√µes (Pend√™ncias e Altera√ß√µes)</h4>
                <div id="pendencias-permissions-container" class="permissions-grid">
                </div>
                <hr>
                
                <h4>Permiss√µes (Confer√™ncia)</h4>
                <div id="conferencias-permissions-container" class="permissions-grid">
                </div>

                </div>
                <div class="modal-footer">
                    <button type="button" id="btn-cancel-user-modal" class="btn btn--secondary close-modal">Cancelar</button>
                    <button type="submit" id="btn-save-user" class="btn btn--primary">Salvar</button>
                </div>
                </form>
                </div>
                </div>
{% endblock %}