{% extends "base.html" %}

{% block title %}Recebimento de Mercadorias{% endblock %}

{% block content %}
<!-- SeÃ§Ã£o Superior: BotÃµes de Registro -->
<section class="form-container" style="max-width: 800px; text-align: center;">
    <h2>Registrar Recebimento de Nota</h2>
    <p>Selecione o tipo de nota que estÃ¡ sendo recebida.</p>
    <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 1.5rem;">
        <button id="btn-abrir-modal-fornecedor" class="btn btn--primary" style="flex-grow: 1;">Registrar Nota de
            Fornecedor</button>
        <button id="btn-abrir-modal-rua" class="btn btn--secondary" style="flex-grow: 1;">Registrar Nota da Rua
            (Local)</button>
    </div>
</section>

<hr>

<!-- SeÃ§Ã£o Principal: Filtros e Tabela -->
<section class="form-container" style="max-width: 1600px;">
    <h2>Recebimentos</h2>

    <!-- ÃREA DE FILTROS -->
    <div class="layout-grid-4-cols" style="gap: 1rem; margin: 2rem 0; align-items: end;">
        <div class="form-group" style="margin-bottom: 0;">
            <label for="filtro-data-inicio">De:</label>
            <input type="date" id="filtro-data-inicio">
        </div>
        <div class="form-group" style="margin-bottom: 0;">
            <label for="filtro-data-fim">AtÃ©:</label>
            <input type="date" id="filtro-data-fim">
        </div>
        <div class="form-group" style="margin-bottom: 0;">
            <label for="filtro-status">Status:</label>
            <select id="filtro-status">
                <option value="">Todos</option>
                <option value="Aguardando ConferÃªncia">Aguardando ConferÃªncia</option>
                <option value="Em ConferÃªncia">Em ConferÃªncia</option>
                <option value="Pendente">Com PendÃªncias (Todas)</option>
                <option value="Finalizado">Finalizado</option>
            </select>
        </div>
        <div class="form-group" style="margin-bottom: 0;">
            <label for="filtro-geral-recebimentos">Busca Geral:</label>
            <input type="search" id="filtro-geral-recebimentos" placeholder="ðŸ”Ž NF, Fornecedor, Vendedor...">
        </div>
    </div>

    <!-- BotÃ£o para limpar filtros -->
    <div style="text-align: right; margin-bottom: 1.5rem;">
        <button id="btn-limpar-filtros-recebimento" class="btn btn--secondary btn--sm">Limpar Filtros</button>
    </div>

    <div id="loading-spinner-tabela" class="spinner" style="display: block; margin: 2rem auto;"></div>

    <table id="tabela-recebimentos" class="admin-table" style="display: none; width: 100%;">
        <thead>
            <tr>
                <th>Data/Hora</th>
                <th>NÂº NF</th>
                <th>Fornecedor</th>
                <th>Transportadora / Vendedor</th>
                <th>Volumes</th>
                <th>Recebido por</th>
                <th>Status</th>
                <th>AÃ§Ãµes</th>
            </tr>
        </thead>
        <tbody id="tabela-recebimentos-body"></tbody>
    </table>

    <div id="pagination-container" class="pagination-container" style="margin-top: 1rem;">
        <button id="btn-carregar-mais" class="btn btn--secondary" style="display: none;">Carregar mais antigos</button>
    </div>
</section>

<!-- --- MODAIS --- -->

<!-- MODAL DE EDIÃ‡ÃƒO -->
<div id="edit-recebimento-modal-overlay" class="modal-overlay" style="display:none;">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="edit-recebimento-modal-title">Editar Recebimento</h2>
            <button class="close-modal close-modal-icon">Ã—</button>
        </div>
        <form id="form-edit-recebimento" novalidate>
            <div class="modal-body">
                <div class="form-group">
                    <label for="edit-numero-nota-fiscal">NÂº Nota Fiscal</label>
                    <input type="text" id="edit-numero-nota-fiscal" required>
                </div>
                <div class="form-group">
                    <label for="edit-nome-fornecedor">Nome do Fornecedor</label>
                    <input type="text" id="edit-nome-fornecedor" required>
                </div>
                <div class="form-group" id="edit-transportadora-group">
                    <label for="edit-nome-transportadora">Transportadora</label>
                    <input type="text" id="edit-nome-transportadora" required>
                </div>
                <!-- Grupo de Vendedor para EdiÃ§Ã£o -->
                <div class="form-group" id="edit-vendedor-group" style="display: none;">
                    <label for="edit-nome-vendedor">Vendedor(es)</label>
                    <div id="edit-vendedores-container" class="vendedores-grid">
                        <div class="spinner"></div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="edit-qtd-volumes">Qtd. Volumes</label>
                    <input type="number" id="edit-qtd-volumes" required min="1">
                </div>
                <div class="form-group">
                    <label for="edit-recebido-por">Recebido por</label>
                    <input type="text" id="edit-recebido-por" required>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" id="btn-excluir-recebimento" class="btn btn--danger"
                    style="margin-right: auto;">Excluir</button>
                <button type="button" id="btn-cancel-edit-recebimento"
                    class="btn btn--secondary close-modal">Cancelar</button>
                <button type="submit" id="btn-save-edit-recebimento" class="btn btn--primary">Salvar AlteraÃ§Ãµes</button>
            </div>
        </form>
    </div>
</div>

<!-- MODAL: Registrar Nota de Fornecedor -->
<div id="modal-fornecedor-overlay" class="modal-overlay" style="display:none;">
    <div class="modal-content" style="max-width: 600px;">
        <div class="modal-header">
            <h2>Registrar Nota de Fornecedor</h2>
            <button class="close-modal close-modal-icon">Ã—</button>
        </div>
        <form id="form-nota-fornecedor">
            <div class="modal-body">
                <div class="form-group">
                    <label for="fornecedor-numero-nota">NÂº Nota Fiscal</label>
                    <input type="text" id="fornecedor-numero-nota" required>
                </div>
                <div class="form-group">
                    <label for="fornecedor-nome">Fornecedor</label>
                    <input type="text" id="fornecedor-nome" required>
                </div>
                <div class="form-group">
                    <label for="fornecedor-transportadora">Transportadora</label>
                    <input type="text" id="fornecedor-transportadora" required>
                </div>
                <div class="form-group">
                    <label for="fornecedor-qtd-volumes">Qtd. Volumes</label>
                    <input type="number" id="fornecedor-qtd-volumes" required min="1">
                </div>
                <div class="form-group">
                    <label for="fornecedor-recebido-por">Recebido por</label>
                    <input type="text" id="fornecedor-recebido-por" required>
                </div>
                <div class="form-group">
                    <label for="fornecedor-observacao">ObservaÃ§Ã£o Inicial (Opcional)</label>
                    <textarea id="fornecedor-observacao" rows="2"
                        placeholder="Ex: Caixa amassada, volume aberto..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn--secondary close-modal">Cancelar</button>
                <button type="submit" class="btn btn--primary">Registrar Entrada</button>
            </div>
        </form>
    </div>
</div>

<!-- MODAL: Registrar Nota da Rua -->
<div id="modal-rua-overlay" class="modal-overlay" style="display:none;">
    <div class="modal-content" style="max-width: 600px;">
        <div class="modal-header">
            <h2>Registrar Nota da Rua</h2>
            <button class="close-modal close-modal-icon">Ã—</button>
        </div>
        <form id="form-nota-rua">
            <div class="modal-body">
                <div class="form-group">
                    <label for="rua-numero-nota">NÂº Nota Fiscal</label>
                    <input type="text" id="rua-numero-nota" required>
                </div>
                <div class="form-group">
                    <label for="rua-nome-fornecedor">Fornecedor</label>
                    <input type="text" id="rua-nome-fornecedor" required>
                </div>
                <div class="form-group">
                    <label>Selecione os ResponsÃ¡veis (Vendedores/Motoristas)</label>
                    <div id="rua-vendedores-container" class="vendedores-grid">
                        <div class="spinner"></div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="rua-qtd-volumes">Qtd. Volumes</label>
                    <input type="number" id="rua-qtd-volumes" required min="1">
                </div>
                <div class="form-group">
                    <label for="rua-recebido-por">Recebido por</label>
                    <input type="text" id="rua-recebido-por" required>
                </div>
                <hr>
                <div class="form-group">
                    <label for="rua-observacao">ObservaÃ§Ã£o (ObrigatÃ³ria se solicitar alteraÃ§Ã£o)</label>
                    <textarea id="rua-observacao" rows="3"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn--secondary close-modal">Cancelar</button>
                <button type="button" id="btn-rua-finalize-ok" class="btn btn--success">Finalizar OK</button>
                <button type="submit" id="btn-rua-solicitar-alteracao" class="btn btn--primary">Solicitar
                    AlteraÃ§Ã£o</button>
            </div>
        </form>
    </div>
</div>

{% endblock %}