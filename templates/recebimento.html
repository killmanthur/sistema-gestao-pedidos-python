{% extends "base.html" %}

{% block title %}Recebimento de Mercadorias{% endblock %}

{% block content %}
<section class="form-container" style="max-width: 1200px;">
    <h2>Registrar Recebimento de Nota</h2>
    <form id="form-recebimento">
        <!-- NOVO: Checkbox "Nota da Rua" -->
        <div class="form-group" style="margin-bottom: 2rem; display: flex; align-items: center; gap: 0.75rem;">
            <input type="checkbox" id="nota-da-rua-checkbox" style="width: auto; height: auto;">
            <label for="nota-da-rua-checkbox" style="margin-bottom: 0;">√â uma Nota da Rua? (Compra Local)</label>
        </div>

        <div class="layout-grid-4-cols" style="align-items: flex-end;">
            <div class="form-group">
                <label for="numero-nota-fiscal">N¬∫ Nota Fiscal</label>
                <input type="text" id="numero-nota-fiscal" required>
            </div>
            <div class="form-group">
                <label for="nome-fornecedor">Fornecedor</label>
                <input type="text" id="nome-fornecedor" required>
            </div>
            <!-- MUDAN√áA: Adicionado um ID ao grupo da transportadora -->
            <div class="form-group" id="transportadora-group">
                <label for="nome-transportadora">Transportadora</label>
                <input type="text" id="nome-transportadora" required>
            </div>
            <!-- NOVO: Grupo do Vendedor (inicialmente oculto) -->
            <div class="form-group" id="vendedor-group" style="display: none;">
                <label for="nome-vendedor">Vendedor</label>
                <select id="nome-vendedor">
                    <option value="" disabled selected>Carregando...</option>
                </select>
            </div>
            <div class="form-group">
                <label for="qtd-volumes">Qtd. Volumes</label>
                <input type="number" id="qtd-volumes" required min="1">
            </div>
        </div>
        <button type="submit" class="btn btn--primary" style="width: 100%; margin-top: 1rem;">Registrar Entrada</button>
    </form>
</section>

<hr>

<section class="form-container" style="max-width: 1400px;">
    <h2>Recebimentos Recentes</h2>

    <div style="margin: 2rem 0;">
        <input type="search" id="filtro-geral-recebimentos" placeholder="üîé Buscar em todos os campos...">
    </div>

    <div id="loading-spinner-tabela" class="spinner" style="display: block; margin: 2rem auto;"></div>
    <table id="tabela-recebimentos" class="admin-table" style="display: none; width: 100%;">
        <thead>
            <tr>
                <th><input type="text" class="filtro-coluna" data-col="data_recebimento" placeholder="Data/Hora"></th>
                <th><input type="text" class="filtro-coluna" data-col="numero_nota_fiscal" placeholder="N¬∫ NF"></th>
                <th><input type="text" class="filtro-coluna" data-col="nome_fornecedor" placeholder="Fornecedor"></th>
                <!-- MUDAN√áA: O placeholder agora √© gen√©rico -->
                <th><input type="text" class="filtro-coluna" data-col="transportadora_ou_vendedor"
                        placeholder="Transportadora / Vendedor"></th>
                <th><input type="text" class="filtro-coluna" data-col="qtd_volumes" placeholder="Volumes"></th>
                <th>
                    <select class="filtro-coluna" data-col="status">
                        <option value="">Status (Todos)</option>
                        <option value="Aguardando Confer√™ncia">Aguardando Confer√™ncia</option>
                        <option value="Em Confer√™ncia">Em Confer√™ncia</option>
                        <option value="Pendente de Resolu√ß√£o">Pendente de Resolu√ß√£o</option>
                        <option value="Finalizado">Finalizado</option>
                    </select>
                </th>
                <th>A√ß√µes</th>
            </tr>
        </thead>
        <tbody id="tabela-recebimentos-body"></tbody>
    </table>
</section>

<div id="edit-recebimento-modal-overlay" class="modal-overlay" style="display:none;">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="edit-recebimento-modal-title">Editar Recebimento</h2>
            <!-- CORRE√á√ÉO AQUI -->
            <button class="close-modal close-modal-icon">√ó</button>
        </div>
        <form id="form-edit-recebimento" novalidate>
            <div class="modal-body">
                <div class="form-group">
                    <label for="edit-numero-nota-fiscal">N¬∫ Nota Fiscal</label>
                    <input type="text" id="edit-numero-nota-fiscal" required>
                </div>
                <div class="form-group">
                    <label for="edit-nome-fornecedor">Nome do Fornecedor</label>
                    <input type="text" id="edit-nome-fornecedor" required>
                </div>
                <div class="form-group">
                    <label for="edit-nome-transportadora">Transportadora</label>
                    <input type="text" id="edit-nome-transportadora" required>
                </div>
                <div class="form-group">
                    <label for="edit-qtd-volumes">Qtd. Volumes</label>
                    <input type="number" id="edit-qtd-volumes" required min="1">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" id="btn-excluir-recebimento" class="btn btn--danger"
                    style="margin-right: auto;">Excluir</button>
                <!-- CORRE√á√ÉO AQUI (j√° estava certo, mas confirmando) -->
                <button type="button" id="btn-cancel-edit-recebimento"
                    class="btn btn--secondary close-modal">Cancelar</button>
                <button type="submit" id="btn-save-edit-recebimento" class="btn btn--primary">Salvar Altera√ß√µes</button>
            </div>
        </form>
    </div>
</div>

<div id="finalize-modal-overlay" class="modal-overlay" style="display:none;">
    <div class="modal-content" style="max-width: 500px;">
        <div class="modal-header">
            <!-- CORRE√á√ÉO 1: Adicione o ID ao h2 -->
            <h2 id="finalize-modal-title">Finalizar Nota da Rua</h2>
            <button class="close-modal close-modal-icon">√ó</button>
        </div>
        <form id="form-finalize">
            <div class="modal-body">
                <p><strong>Finalizar OK:</strong> A nota ser√° registrada como finalizada diretamente.</p>
                <p><strong>Solicitar Altera√ß√£o:</strong> A nota ser√° enviada para a contabilidade com a sua observa√ß√£o.
                    <strong>A observa√ß√£o √© obrigat√≥ria neste caso.</strong>
                </p>
                <hr style="margin: 1rem 0;">
                <div class="form-group">
                    <label for="finalize-observacao">Observa√ß√£o (Opcional para Finalizar OK)</label>
                    <textarea id="finalize-observacao" rows="4"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn--secondary close-modal">Cancelar</button>
                <!-- CORRE√á√ÉO 2: Garanta que este seja type="button" -->
                <button type="button" id="btn-finalize-ok" class="btn btn--success">Finalizar OK</button>
                <!-- CORRE√á√ÉO 3: Garanta que este seja type="submit" para acionar o form -->
                <button type="submit" id="btn-solicitar-alteracao" class="btn btn--primary">Solicitar Altera√ß√£o</button>
            </div>
        </form>
    </div>
</div>

{% endblock %}